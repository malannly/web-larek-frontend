# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Паттерн

В данной проектной работе для построения архитектуры приложения будет использован паттерн mvp (Model-View-Presenter):
- Model (модель) -> бизнес-логика приложения, база данных, то что будет использовано для технической реализации всех функций
- View (вид) -> интерфейс пользователя, то с чем он будет взаимодействовать в приложении.
- Presenter (представитель) -> посредник между моделью и представлением. Он содержит бизнес-логику приложения и управляет взаимодействием между моделью и представлением. Презентер получает данные от модели, форматирует их и передает представлению для отображения.

## Описание приложения

Приложение состоит из нескольких основных частей: главная страница и модальные окна.
Все модальные окна имеют общую логику: значок "крестик" для закрытия окна, затемнение заднего фона при открытии, поля ввода должны иметь placeholder, а при повторном открытии очищаться

Главная страница:
пользователь видит список доступных товаров
в header страницы отображаются логотип и значок корзины с количеством товаров
Клик по товару открывает модальное окно с, названием, описанием, ценой, возможностью добавить товар в корзину

Клик по корзине открывает модальное окно корзины с списком товаров, их ценами, общей стоимостью, возможностью удалить товар и оформить заказ

Процесс оформления заказа
Клик по кнопке "Оформить заказ" открывает модальное окно выбора способа оплаты и ввода адреса.
После заполнения пользователь нажимает "Далее" и указывает email и номер телефона.
При корректном заполнении переходит к финальному модальному окну с подтверждением заказа.
Отображается сумма списания и галочка подтверждения.

## API

IAppAPI interface - отправляет заказ на сервер, принимает объект с данными (order and contacts) и в резульате возращает promise с результатми оформенного заказа

методы:

getCardItem - загружает карточку с сервера 
getCardList - загружает список карточек с сервера
orderCards - отправляет заказ (оформленый на сервер)

## Model

Model отвечает за хранение данных и бизнес-логику. Она не взаимодействует напрямую с интерфейсом.

AppData

В качестве модели краточки товара для дальнейшей работы используеться LotItem

Управляет данными приложения:
cards - список карточек товара
basket - карточки в корзине (определяються по id)
contacts - данные пользователя (email and phone)
order - данные заказа (адрес и метод оплаты)
preview - карточки в preview (определяються по id)
category - категория краточки
formErrorsContacts - ошибки формы contacts
formErrorsOrder - ошибки формы order

методы:

getCard(id: string) - ищет карточку товара по id.
getCards() - возвращает массив всех карточек товаров.
setCards(cards) - устанавливает список карточек и эмитит событие cards:updated.
addToBasket(item) - добавляет товар в корзину, если его там нет.
removeFromBasket(item) - удаляет товар из корзины.
clearBasket() - очищает корзину.
setPreview(item) - устанавливает preview.
initContacts() - очищает данные формы контактов.
setContacts(field, value) - устанавливает данные покупателя (email, phone).
validateContacts()- проверяет заполнены ли контактные данные.
initOrder() - очищает данные заказа.
setPayment(payment) - устанавливает способ оплаты (cash или card).
setAddress(address) - устанавливает адрес доставки.
validateOrder() - проверяет, указан ли способ оплаты и адрес.
getTotal() - рассчитывает финальную сумму заказа, учитывая цену товаров.
isPayment(x) - проверяет, допустим ли переданный способ оплаты.
getPayment() - возвращает текущий способ оплаты.

## View

View отвечает за отрисовку данных и обработку пользовательских действий.

View modal:
модальное окно (темплейтов)
open - открывает модальное окно
close - закрывает
render - рендерит модальное окно (и сразу открывает)
в конструкторе кнопка закрытия модалки и так же контенер для заполнения содержимого (темплейтов в данном случае)


Общее описание конструктора всех view:
blockName — имя блока 
container — HTML-элемент карточки
actions — объект с обработчиком клика
ensureElement - ищет заголовок

View card:
Три view карточек и все наследуються от одного основного Card (id title price).
вид карточки для главной странице (прибавляеться картинка, категория в конструкторе). сама карточка кнопка (открываеться модалка при клике).
вид карточки модалки наследуеться от карточки на главной странице (добавляеться описание в конструкторе). можно добавить или убрать карточку по клику по кнопке, исключение составляет бесценный товар, он недоступен для покупки (утсанавливаем метод disabled), кнопка меняет текст на "Недоступно" и становится неактивной.
вид карточки корзины добавляеться индекс (порядковый номер добавляеться в конструкторе) карточки
С сервера получаем id, title, image, description and price. устанавливаем с помощью get. так же с помощью сеттера устанавливаем кнопки во view карточек, индекс (в корзине).

View page:
кол во карточек в корзине (счетчик)
список карточек
главный блок страницы
кнопка открытия корзины
устанавливаем все значения с помощью set

View basket:
список карточек
кнопка удаления карточек
кнопка оформления заказа ( вешаем на обработчик событий 'order:open')
сумма всех товаров
устанавливаем все значения с помощью set

View contacts:
email and phone - поля для заполнения пользователя
кнопка при отправки данных (открытие окна success)
устанавливаем все значения с помощью set

View order:
кнопка cash or card (выбор способа оплаты)
поле для заполнения адресса
кнопка чтобы заполнить следущую форму для оформления контактов (вешаем на обработчик событий contacts:open)
устанавливаем все значения с помощью set

View success:
модальное окно при успешной покупке
сумма которая была списана
кнопка чтобы закрыть модальное окно
устанавливаем все значения с помощью set

## Presenter

Представляет собой связь с API, объединив model и view между собой. Берет данные из Model переедает в View

api.getCardList() — вызывает метод getCardList(). отправляет запрос на сервер чтобы получить карточки
setCards(cards: ICardItem[]) обновляет список карточек в appData и вызывает events.emit('cards:updated', cards), чтобы уведомить другие части приложения о новом списке

обработчики событий:

cards:updated - обновляет каталог карточек товаров и счетчик корзины. (обновляет view page)
card:select - открывает превью карточки товара, позволяя добавить или удалить товар из корзины. (рисует view cards - cardsPreview)
basket:open	- открывает корзину, блокируя прокрутку страницы. (рисует view basket)
basket:changed - обновляет отображение корзины (количество и список товаров). (обновляет view basket)
order:changed - проверяет валидность заказа и обновляет форму.
order.address:change - обновляет адрес доставки.
order.payment:change - устанавливает способ оплаты (cash или card).
order:open - открывает форму заказа, если корзина не пуста. (рисует view basket)
FormErrorsOrder:change - обновляет ошибки в форме заказа.
contacts:changed - проверяет валидность данных контактов и обновляет форму.
contacts.open - открывает форму ввода контактных данных. (рисует view контактов)
FormErrorsContacts:change - обновляет ошибки формы контактов.
contacts.submit	- отправляет заказ, если данные корректны, очищает корзину и отображает сообщение об успехе. (рисует view success)
modal:open/close - открывает/закрывает модальное окно с контентом. (рисуеться view темплейтов)

В презентер получает шаблоны:
// Шаблоны
const cardCatalogTemplate = ensureElement<HTMLTemplateElement>('#card-catalog');
const cardPreviewTemplate = ensureElement<HTMLTemplateElement>('#card-preview');
const basketTemplate = ensureElement<HTMLTemplateElement>('#basket');
const cardBasketTemplate = ensureElement<HTMLTemplateElement>('#card-basket');
const orderTemplate = ensureElement<HTMLTemplateElement>('#order');
const contactsTemplate = ensureElement<HTMLTemplateElement>('#contacts');
const successTemplate = ensureElement<HTMLTemplateElement>('#success');

events.on() - подписывается на события с помощью и управляет отрисовкой блоков (краточек в трех состояниях)

## Интерфейс

ICardItem - карточка товара
id, title, image, category, description, price, index

paymentMethod - метод оплаты

IOrderForm - форма заказа товара (paymentMethod and address)

FormErrorsOrder - валидоция ошибок IOrderForm

IOrderResult - результата заказа (id карточек и сумма заказа)

IContactsForm - форма контактов IContactsrForm

ISuccess -  упешная покупка товаров (нужен для view success)

IAppState - состояние приложения (список товаров, id товаров в корзине, данные форм, id карточки в preview? загрузка карточек)